\documentclass[12pt]{article}
\usepackage{graphicx,bm,amssymb,amsmath,amsthm}

% timo macros
\newcommand{\bx}{\textbf{x}}
\newcommand{\by}{\textbf{y}}
\newcommand{\bs}{\textbf{s}}

% alex macros
\newcommand{\bi}{\begin{itemize}}
\newcommand{\ei}{\end{itemize}}
\newcommand{\ben}{\begin{enumerate}}
\newcommand{\een}{\end{enumerate}}
\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand{\bea}{\begin{eqnarray}}
\newcommand{\eea}{\end{eqnarray}}
\newcommand{\bc}{\begin{center}}
\newcommand{\ec}{\end{center}}
\newcommand{\bfi}{\begin{figure}}
\newcommand{\efi}{\end{figure}}
\newcommand{\ca}[2]{\caption{#1 \label{#2}}}
\newcommand{\ig}[2]{\includegraphics[#1]{#2}}
\newcommand{\spl}[2]{\left\{\begin{array}{ll}#1\\#2\end{array}\right.}
\newcommand{\ie}{{\it i.e.\ }}
\newcommand{\eg}{{\it e.g.\ }}
\newcommand{\pd}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\pdc}[3]{\left. \frac{\partial #1}{\partial #2}\right|_{#3}}
\newcommand{\infint}{\int_{-\infty}^{\infty} \!\!}      % infinite integral
\newcommand{\tbox}[1]{{\mbox{\tiny #1}}}
\newcommand{\mbf}[1]{{\bm #1}}           % requires bm package
\newcommand{\pO}{{\partial\Omega}}
\newcommand{\uN}{u^{(N)}}
\newcommand{\emach}{\epsilon_\tbox{mach}}
%\newcommand{\crk}{C_{s}} %C_{R,k}         % const for exponential s(m) bnd
\newcommand{\bmp}[1]{\begin{minipage}{#1}}
\newcommand{\emp}{\end{minipage}}

\newtheorem{thm}{Theorem}
\newtheorem{cnj}{Conjecture}
\newtheorem{lem}{Lemma}[thm]
\newtheorem{cor}{Corollary}[thm]

\newtheorem{rmk}[thm]{Remark}
\newtheorem{pro}[thm]{Proposition}
%\newtheorem{cnj}[thm]{Conjecture}
%\newtheorem{lemma}[thm]{Lemma}

\newcommand{\bp}{{\bf Proof:\ }}   % {\begin{proof}}
\newcommand{\ep}{\hfill $\square$ \vspace{1ex} \\} % {\end{proof}}
% note elsart ones horrible: \pr and \endpr
\newcommand{\bmal}{{\bm \alpha}}             % bold alpha
\newcommand{\xx}{\mbf{x}}             % bold x
\newcommand{\splt}[2]{$\left\{\begin{array}{l}\mbox{#1}\\\mbox{#2}\end{array}\ri
ght.$}
\newcommand{\lo}{{L^2(\Omega)}}
\newcommand{\lpo}{{L^2(\pO)}}
\newcommand{\cu}{\tilde{u}}            % symbol for continuation of u
\newcommand{\cOmega}{\tilde{\Omega}}   % symbol for domain to be continued into
\newcommand{\dmax}{D_\tbox{max}}       % max dist in splane_charge_curve

\newcommand{\tw}{\textwidth}
\newcommand{\vg}{\vspace{2ex}}
 

\begin{document}
\title{{\tt MPSpack} user manual}
\author{Alex Barnett\footnote{Department of Mathematics, Dartmouth College, Hanover, NH, 03755, USA}
and Timo Betcke\footnote{School
of Mathematics, The University of Manchester,
  Manchester, M13 9PL, UK}}
\date{code revision 28: \today}

\maketitle
\begin{abstract}
{\tt MPSpack} is a fully object-oriented MATLAB toolbox that implements the Method of Particular Solutions and related methods (\eg fundamental solutions) for efficient solution of Laplace eigenvalue, interior/exterior Helmholtz problems (\eg wave scattering), and related problems, on piecewise-constant 2D domains.
It is designed to be simple to use, and to enable highly-accurate solutions.
This is the user manual.
\end{abstract}

\section{Overview}

{\tt MPSpack} is a MATLAB toolbox to solve Helmholtz boundary-value
problems (BVP) and
eigenvalue problems (EVP) with particular and fundamental solution methods.

Give example commands, eg eigenmodes of disc.

Define BVP, EVP



Fig.~\ref{f:relat} shows how a geometry is built up from objects, and the
relationships between them.



\bfi % fffffffffffffffffffffffffff
\ig{width=\textwidth}{relat.eps}
\ca{Relationship of {\tt MPSpack}
objects used to solve a typical BVP or EVP.
The physical geometry is shown on the left, and the code structures on the
right.
Each segment has a normal direction. Each domain is built from
segments with a list of signs ($+$ or $-$) which define the sense in which
the segments are used to form the boundary.
Basis sets affect the function values inside each domain in which they
are referenced. A basis set may influence more than one domain.}{f:relat}
\efi

\section{Installation}

Requirements:
\bi
\item MATLAB version 7.6 (2008a) or newer.
\ei

We make use of the object-oriented programming ability of MATLAB which
unfortunately means the toolbox cannot work with versions earlier than 7.6.


The project is hosted at
{\tt http://code.google.com/p/mpspack}

To download it you need to first install the {\tt subversion} (SVN) version
control software from {\tt http://subversion.tigris.org}

Anonymous check out of {\tt MPSpack} is then via the subversion command:

{\tt svn checkout http://mpspack.googlecode.com/svn/trunk/ mpspack-read-only}

This creates a directory {\tt mpspack-read-only} in which you will find
the {\tt mpspack} subdirectory.

Alternatively you might prefer a more user-friendly graphical
subversion client such as those listed at 
{\tt http://subversion.tigris.org/links.html\#clients}

You should now add the {\tt mpspack}
subdirectory to your MATLAB path, for instance by adding the line

{\tt addpath 'path/to/mpspack-read-only/mpspack';}

to your MATLAB {\tt startup.m} file

You are now ready to use {\tt MPSpack}


\subsection{Boundary-value problems}

Let $\Omega \subset \mathbb{R}^2$

\bea
(\Delta+k^2)u& =& 0 \qquad \mbox{in } \Omega\\
au + b u_n&=&f\qquad \mbox{on } \pO
\eea

In our implementation we restrict to functions $a$, $b$ that are
constant on segments used to define the boundary $\pO$.

If $\Omega$ is an exterior domain, we may wish to impose
additional boundary conditions at infinity, such as Sommerfeld's
radiation condition.
This may be achieved by choosing basis sets satisfying this condition.

See \cite{mfs} for
an example of using the Method of Fundamental Solutions to solve
an interior Helmholtz problem.

To solve a BVP the usual flow is as follows:

\ben
\item define piecewise-analytic segments forming all boundaries
\item define domains using various of these segments as their boundaries
\item choose MPS basis set(s) within each domain
\item set up inhomogeneous boundary or matching conditions on each segment
\item solve a %least-squares
linear system to get the basis coefficient vector
\item evaluate solution on desired points
\item plot solution or compute error estimates
\een

\ldots

\subsection{Eigenvalue problems}




\subsection{Geometry}

\ldots

When domains are built from segments, each segment stores information about
which domain, if any, it is connected to on each side.
If segments are to be reused to construct new domains, while erasing any
old domains, the current way to do this is via the {\tt s.disconnect}
command, where {\tt s} is a segment handle or array of such. This clears
these segments of any connections with domains.

The segment object field responsible for
this is {\tt s.dom}, which is a 1-by-2 cell array
of handles to the domain on the segment's natural normal side and
back side respectively. If there is no domain on a particular side, the
cell element is empty.


\subsection{Boundary conditions}

A segment $\Gamma$ may contain a boundary condition on only one of its sides,
of the form
$$
a u(s) + b u_n(s) = f(s)  \qquad s\in\Gamma, \quad a,b \in \mathbb{C}
$$
or, alternatively matching conditions of the form
\bea
%\left.\begin{array}{rcl}
a^+ u^+(s) + a^- u^-(s) &=& f(s)\\
b^+ u_n^+(s) + b^- u_n^-(s) &=& g(s)
\eea
where $a^+,a^-,b^+,b^- \in \mathbb{C}$, and where $u^+$ is the
limiting value approaching the segment from its positive normal side.
In the above $f$ and $g$ are functions on the boundary.
In our implementation the user
may supply these as handles to functions of segment parameter
$t\in[0,1]$, or as a data column vector on the segment quadrature points.

The segment fields {\tt a} and {\tt b} store
$a$ and $b$ for a boundary condition, or
$[a^+, a^-]$ and $[b^+, b^-]$
respectively for a matching condition.

\subsection{Basis sets}

Basis sets exist independently of domains or segments
\footnote{apart from layer potentials which require a segment on which
their source density is placed}.
However, for a basis set to influence a domain {\tt d}, its handle must appear
in the cell array field {\tt d.bas}
This is set up automatically when you perform {\tt d.addregfbbasis()}
or any of the other 

There will be more elaborate basis set types which naturally affect two domains,
such as dielectric corner and transmission layer potential objects;
their handles will appear in the {\tt bas} cell array of more than one domain.


\section{In-depth examples}

\section{Test routines}

The code {\tt testbvp.m} shows the main steps for solution of a BVP on
a variety of domains.

\section{Limitations}

\bi
\item Checking of whether inside a domain is approximate, based on approximating
polygons.
\ei

\section{List of improvements to make}

List to be prioritized:

\bi
\item make {\tt segment.bdryfunc} which creates $u$, $u_n$ data given a
field function and its gradient field function, useful for choosing BC
data corresponding to exact fields
\item make {\tt domain.setbc} which uses one BC data function on all segments
\item eigenvalue problems: MPS, scaling method
\item segment methods to create analytic interpolant function from boundary
point data, enabling user to specify a segment using points on a curve.
\item add better automated ways to choose MFS charge points, based on JCP paper
\item add layer-potential bases, and associated periodic quadrature methods
\item write {\tt segment.bdrysolution} which evaluates $u$, $u_n$ on one
or other side of a boundary. For layer potentials this would take into account
jump relations. This should then be used in {\tt problem.fillbcmatrix}
\item keep discrepancy and evaluation matrices, for efficiency in multiple
right-hand sides.
\item classes which symmetrize basis sets for single reflection, $C_4$, etc
symmetry, by wrapping the calls to basis evaluations using reflection
points
\item dielectric constants, overall frequency,
automatically changing $k$ in domains
\item periodic boundary conditions connecting values and derivatives
on given sides of two different segments, needed for photonic crystals
\item allow nufbbasis to accept empty k input, like other basis types.
\item make better addnufbbasis which attaches to a requested corner.
\item basisgeom for nufbbasis, split off utils.plotfan from domain.plot and
use.
\ei

\section{Known bugs}

Please alert the authors to any bugs you discover, including a description
of how to reproduce the behavior, using the interface at

{\tt http://code.google.com/p/mpspack/issues/list}

\bibliographystyle{siam} 
\bibliography{alexrefs}



\end{document}
